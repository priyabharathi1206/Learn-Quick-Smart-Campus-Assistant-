<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ask a Question </title>

<style>
    body {
        margin: 0;
        padding: 0;
        background: #f4f9ff;
        font-family: Arial, sans-serif;
        height: 100vh;
        display: flex;
        flex-direction: column;
    }

    
    .header {
        background: #2a6fcf;
        color: white;
        padding: 15px;
        text-align: center;
        font-size: 22px;
        font-weight: bold;
    }

   
    .chat-container {
        flex: 1;
        overflow-y: auto;
        padding: 15px;
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .msg {
        max-width: 70%;
        padding: 10px 14px;
        border-radius: 12px;
        font-size: 16px;
        line-height: 1.4;
    }

    .user {
        align-self: flex-end;
        background: #d6e8ff;
        border: 2px solid #aacbff;
    }

    .bot {
        align-self: flex-start;
        background: white;
        border: 2px solid #dce6f7;
    }

    .input-area {
        display: flex;
        padding: 10px;
        background: white;
        border-top: 2px solid #d6e8ff;
    }

    input {
        flex: 1;
        padding: 12px;
        border-radius: 8px;
        border: 2px solid #d6e8ff;
        outline: none;
        font-size: 16px;
    }

    button {
        margin-left: 10px;
        padding: 12px 18px;
        background: #2a6fcf;
        color: white;
        border-radius: 8px;
        border: none;
        cursor: pointer;
        font-size: 16px;
        transition: 0.2s;
    }

    button:hover {
        background: #1c54a3;
    }
      
</style>

</head>
<body>

<div class="header">Ask a Question</div>
<div style="text-align:left; padding: 10px 20px; margin: 20px auto; ">
    <button onclick="goBack()" 
        style="background:#1c54a3; padding:8px 16px; font-size:14px; border-radius:6px;">
        ‚Üê Back 
    </button>
</div>


<!-- Chat Box -->
<div class="chat-container" id="chatBox"></div>

<!-- Input Area -->
<div class="input-area">
    <input type="text" id="userInput" placeholder="Type your question..." onkeypress="handleEnter(event)">
    <button onclick="sendMessage()">Send</button>
</div>

<script>

    // Load chat from localStorage
    let chatHistory = JSON.parse(localStorage.getItem("learnquick_chat")) || [];

    const chatBox = document.getElementById("chatBox");

    function displayChat() {
        chatBox.innerHTML = "";
        chatHistory.forEach(msg => {
            let div = document.createElement("div");
            div.classList.add("msg", msg.sender);
            div.innerText = msg.text;
            chatBox.appendChild(div);
        });
        chatBox.scrollTop = chatBox.scrollHeight;
    }

    displayChat();

    
    async function sendMessage() {
    let text = document.getElementById("userInput").value.trim();
    if (text === "") return;

    // Add user message
    addMessage("user", text);
    document.getElementById("userInput").value = "";

    // Send to API
    try {
        const formData = new FormData();
        formData.append("question", text);

        const response = await fetch("/ask", {
            method: "POST",
            body: formData
        });

        const data = await response.json();
        let botReply = data.answer || data.error || "Sorry, I couldn't understand.";

        addMessage("bot", botReply);

    } catch (e) {
        addMessage("bot", "Server unreachable. Please try again.");
    }
}

    // Add message to chat and save
    function addMessage(sender, text) {
        chatHistory.push({ sender, text });
        localStorage.setItem("learnquick_chat", JSON.stringify(chatHistory));
        displayChat();
    }

    // Send on Enter Key
    function handleEnter(e) {
        if (e.key === "Enter") sendMessage();
    }


    function goBack() {
    window.location.href = "/features";
}
</script>

</body>
</html>
